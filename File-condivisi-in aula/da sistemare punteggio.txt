class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("\nINDOVINA NUMERO\n");

        while (true)
        {
            int puntiUmano = 0;
            int puntiPC = 0;

            Console.WriteLine("I punti sono:                             Tu          Io");
            Console.WriteLine("Partita vinta                            +3p");
            Console.WriteLine("Partita persa                            -3p         +2p");
            Console.WriteLine("Vittoria                                +12p");
            Console.WriteLine("Sconfitta                               -12p        +12p");

            while (Math.Abs(puntiUmano) < 12 && Math.Abs(puntiPC) < 12)
            {
                //TODO genero numero casuale
                int numeroCasuale = new Random().Next(1, 101);
                int numeroTentativi = 0;

                // //! Visualizzo il numero casuale per verificare
                // Console.WriteLine($"{numeroCasuale}");

                Console.WriteLine("\nIn quanti tentativi indovini il numero?\n");
                int tentativiMax = int.Parse(Console.ReadLine());

                //TODO Eseguo il codice
                do
                {
                    numeroTentativi++;
                    int tentativiRimasti = tentativiMax - numeroTentativi;

                    while (tentativiRimasti >= 0)
                    {

                        //TODO richiedo il numero
                        Console.WriteLine("\nIndovina numero tra 1 e 100\n");
                        int insert = int.Parse(Console.ReadLine());

                        //TODO genero numero causale per thread.sleep
                        int sleep = new Random().Next(300, 1001);

                        //TODO confronto e stampo risultato

                        //? Numero indovinato
                        if (insert == numeroCasuale)
                        {
                            puntiUmano += 3;
                            Thread.Sleep(sleep);
                            Console.ForegroundColor = ConsoleColor.Green;
                            Console.WriteLine($"\nNumero casuale e' {numeroCasuale}. \nHai indovinato in {numeroTentativi} tentativi! \nSicuramente hai barato! :P\n");
                            Console.WriteLine($"\nHai ricevuto 3 punti. \nTuo punteggio adesso e' {puntiUmano}\nMio punteggio adesso e' {puntiPC}\n");
                            Console.ResetColor();
                            //! CORREGGERE L'AZZERAMENTO DEI TENTATIVI QUANDO IL NUMERO E' INDOVINATO
                            tentativiRimasti=0;
                            break;
                        }

                        //? Numero non indovinato, tentativi non finiti
                        else
                        {
                            int somma = insert + numeroCasuale;
                            if (tentativiRimasti > 0)
                            {
                                Thread.Sleep(sleep);
                                Console.ForegroundColor = ConsoleColor.Magenta;
                                Console.WriteLine($"\nNon hai indovinato! \nTentativi rimasti: {tentativiRimasti}");
                                Console.ResetColor();
                                if (numeroCasuale < insert)
                                {
                                    Console.ForegroundColor = ConsoleColor.DarkCyan;
                                    Console.WriteLine($"\nNumero casuale e' minore del numero {insert}. \nLa somma del numero da indovinare e {insert} e' {somma}. \nRiprova!");
                                    Console.ResetColor();
                                }
                                else
                                {
                                    Console.ForegroundColor = ConsoleColor.Yellow;
                                    Console.WriteLine($"\nNumero casuale e' maggiore del numero {insert}. \nLa somma del numero da indovinare e {insert} e' {somma} \nRiprova!");
                                    Console.ResetColor();
                                }
                            }
                            //TODO Interrompo quando il numero di tentativi supera limite impostato
                            else
                            {
                                puntiUmano -= 3;
                                puntiPC += 2;
                                Console.ForegroundColor = ConsoleColor.Cyan;
                                Console.WriteLine($"\nTentativi finiti!");
                                Console.ResetColor();

                                Thread.Sleep(1000);
                                Console.ForegroundColor = ConsoleColor.Red;
                                Console.WriteLine($"\nNumero casuale e' {numeroCasuale}. \nAHAHAHA!!! Non hai indovinato! La risposta era cosi' evidente!\nHai perso 3 punti!\nTuo punteggio adesso e' {puntiUmano}\nMio punteggio adesso e' {puntiPC}");
                                Console.ResetColor();
                            }
                        }
                        break;
                    }
                }
                while (numeroTentativi <= tentativiMax);
            }

            if (puntiUmano >= 12)
            {
                Console.ForegroundColor = ConsoleColor.Green;
                Console.WriteLine("Hai vinto!");
                Console.ResetColor();
            }
            else if (puntiPC >= 12 || puntiUmano <= -12)
            {
                Console.ForegroundColor = ConsoleColor.Red;
                Console.WriteLine("Hai perso!");
                Console.ResetColor();
            }
            Console.WriteLine("Vuoi continuare? (s/n)");
            string risposta = Console.ReadLine()!;
            if (risposta == "n")
            {
                break;
            }
        }
    }
}